function init(){getCurrentPosition(),retrieveFromDB(),signIn(),signOut(),authStateChange(),submitReport()}function retrieveFromDB(){var a=firebase.database().ref("reports/").limitToLast(100);a.on("child_added",function(a){addReportElement(a.val().lng)})}function addReportElement(a){$(".recent-reports").append("<p>"+a+"</p>")}function getCurrentPosition(){var a={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};navigator.geolocation?navigator.geolocation.getCurrentPosition(saveGeoData,error,a):alert("Sorry, you do not have geolocation enabled for your browser")}function saveGeoData(a){reportData.lat=a.coords.latitude,reportData.lng=a.coords.longitude}function error(a){console.warn("ERROR("+a.code+"): "+a.message)}function saveTextData(){reportData.msg=$("#new-report-message").val()}function saveDate(){var a=new Date;reportData.dateTime=a}function sendToDB(){var a=firebase.database().ref().child("reports").push().key,b={};return b["/reports/"+a]=reportData,b["/user-reports/"+reportData.user+"/"+a]=reportData,firebase.database().ref().update(b)}function submitReport(){$("#submit-report").click(function(a){a.preventDefault(),console.log("Submit Report clicked!"),console.log(reportData),saveTextData(),saveDate(),sendToDB()})}function signIn(){$("#sign-in").click(function(){console.log("sign in clicked"),firebase.auth().signInAnonymously()})}function signOut(){$("#sign-out").click(function(){console.log("sign out clicked"),alert("User signed out!"),firebase.auth().signOut()})}function authStateChange(){firebase.auth().onAuthStateChanged(function(a){a&&(alert("User signed-in!"),writeUserData(a.uid),reportData.user=a.uid)})}function writeUserData(a){firebase.database().ref("users/"+a).set({userId:a})}var reportData={};$(function(){init()});var jic={compress:function(a,b,c){var d="image/jpeg";"undefined"!=typeof c&&"png"==c&&(d="image/png");var e=document.createElement("canvas");e.width=a.naturalWidth,e.height=a.naturalHeight;var f=(e.getContext("2d").drawImage(a,0,0),e.toDataURL(d,b/100)),g=new Image;return g.src=f,g},upload:function(a,b,c,d,e,f,g,h){void 0===XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a){var b=Array.prototype.map.call(a,function(a){return 255&a.charCodeAt(0)});this.send(new Uint8Array(b).buffer)});var i="image/jpeg";".png"==d.substr(-4).toLowerCase()&&(i="image/png");var j=a.src;j=j.replace("data:"+i+";base64,","");var k=new XMLHttpRequest;k.open("POST",b,!0);var l="someboundary";if(k.setRequestHeader("Content-Type","multipart/form-data; boundary="+l),h&&"object"==typeof h)for(var m in h)k.setRequestHeader(m,h[m]);g&&g instanceof Function&&(k.upload.onprogress=function(a){a.lengthComputable&&g(a.loaded/a.total*100)}),k.sendAsBinary(["--"+l,'Content-Disposition: form-data; name="'+c+'"; filename="'+d+'"',"Content-Type: "+i,"",atob(j),"--"+l+"--"].join("\r\n")),k.onreadystatechange=function(){4==this.readyState&&(200==this.status?e(this.responseText):this.status>=400&&f&&f instanceof Function&&f(this.responseText))}}},source_img=document.getElementById("source_img").files[0];target_img=document.getElementById("target_img");var quality=80,output_format="jpg",target_img=jic.compress(source_img,quality,output_format).src;